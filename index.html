<script>
const container=document.getElementById("produk");
const modal=document.getElementById("modal");
const waBtn=document.getElementById("waBtn");
const igBtn=document.getElementById("igBtn");
const search=document.getElementById("search");
const btnCari=document.getElementById("btnCari");

let data=[];

/* ===============================
   FIX UTAMA: PATH ANTI BUG
   =============================== */
const basePath = window.location.pathname
  .replace(/\/[^\/]*$/, "/");

fetch(basePath + "produk.json")
.then(r=>{
  if(!r.ok) throw new Error("produk.json tidak ditemukan");
  return r.json();
})
.then(j=>{
  data=j;
  tampilkan(data.filter(p=>!p.sold));
})
.catch(err=>{
  console.error(err);
  container.innerHTML=`
    <div class="empty">
      Gagal memuat produk<br>
      <b>Hubungi Admin AryanzUtama</b>
    </div>`;
});

/* ===============================
   TAMPILKAN PRODUK
   =============================== */
function tampilkan(list){
  container.innerHTML="";
  if(!list.length){
    container.innerHTML=`
      <div class="empty">
        stok kategori yang kamu cari sedang kosong<br>
        <b>hubungin AryanzUtama untuk melanjutkan</b>
      </div>`;
    return;
  }

  list.forEach(p=>{
    const c=document.createElement("div");
    c.className="card";
    c.innerHTML=`<img src="${p.foto}" loading="lazy">`;
    c.onclick=()=>bukaModal(p.kategori);
    container.appendChild(c);
  });
}

/* ===============================
   SEARCH
   =============================== */
btnCari.onclick=()=>{
  const v=search.value.trim().toLowerCase();
  tampilkan(data.filter(p=>!p.sold && p.kategori.toLowerCase()===v));
};

/* ===============================
   MODAL
   =============================== */
function bukaModal(k){
  modal.classList.add("show");
  waBtn.href=`https://wa.me/6289679520905?text=Halo%20Admin,%20saya%20sudah%20transfer%20kategori%20${k}`;
  igBtn.href="https://www.instagram.com/aryanz_stok";
}

function tutupModal(){
  modal.classList.remove("show");
}
</script>
